<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  
  <title>inBetween</title>
  
  <meta name="description" content="textSaver.js" />
  <meta name="keywords" value="inBetween webapp HTML5 jquery geolocation javascript" />

  <script type="text/javascript" src="js/jquery.min.js"> </script>

  <script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=AIzaSyBBHnPSnGsWXVzwAlUhBQdb9WAw8HWB2uw&sensor=true"> </script>

	<link rel="stylesheet" type="text/css" href="css/style.css" />

</head>
<body>

	<div id="head">
		<center>
			Tell us where you are, and where your friend is. <br />
			We'll help you find cool places <strong><em>inBetween</em></strong> you! <br />
			<br />
		</center>
	</div>

	<div id="top">
		<center>
		<form id="your_loc" method="post" action="?submitted">
			<label for="textarea1">Where are you now?: </label>
			<textarea id="textarea1" name="textarea1" rows="1" cols="25"></textarea>
			<br />
			<label for="textarea2">Where's your friend? </label>
			<textarea id="textarea2" name="textarea2" rows="1" cols="25"></textarea>
			<br />
			<label for="textarea3">Place of interest? </label>
			<textarea id="textarea3" name="textarea3" rows="1" cols="25"></textarea>
			<br />
			<input type="submit" value="Let's go!" />
			<br />
		</form>
		</center>
	</div>
	
	<div id="map_canvas"></div>
	<div id="names"></div>

	<script>

		var yourLoc = 'Princeton University';
		var otherLoc = 'NYC';
		var poi = '';

		/* $("#textarea1").blur = function() { 
    		yourLoc = this.value;
    		console.log(yourLoc);
    	}
    	$("#textarea2").blur = function() { 
    		otherLoc = this.value;
    		console.log(otherLoc);
    	}
    	$("#textarea3").blur = function() { 
    		poi = this.value;
    		console.log(poi);
    	} */

    	function getLat(address) {
    		var map = new GMap2(document.getElementById("map_canvas"));
			var geocoder = new GClientGeocoder();
			var latitude = 0;
			var longitude = 0;
			geocoder.getLatLng(address, function(point) {
         	latitude = point.y;
         	longitude = point.x;  
         	});
         	return latitude;
    	}

    	function getLon(address) {
    		var map = new GMap2(document.getElementById("map_canvas"));
			var geocoder = new GClientGeocoder();
			var latitude = 0;
			var longitude = 0;
			geocoder.getLatLng(address, function(point) {
         	latitude = point.y;
         	longitude = point.x;  
         	});
         	return longitude;
    	}

    	var yourLat = getLat(yourLoc);
    	var otherLat = getLat(otherLoc);
    	var lat = (yourLat + otherLat)/2;

    	var yourLon = getLon(yourLoc);
    	var otherLon = getLon(otherLoc);
    	var lon = (yourLon + otherLon)/2;

		var lati = (lat).toString();
		var longi = (lon).toString();
		var query = poi;

		var url = 'https://api.foursquare.com/v2/venues/search?ll='+lati+','+longi+'&query='+query+'&client_id=2POUFAUU4ZBJ2MTDOY3S2YHR2NIT52FYW0LUTPHBMNTJFJNQ&client_secret=YFDZI1YWV3ZI5S5SPM2DZJEQIEBPIDJ5XFZBWTIKIQZVQNYM&v=20120101';

		$.getJSON(url,
		    function(data) {
		        $.each(data.response.venues, function(i,venues){
		            content = '<center>';
		            content += '<p> <br />';
					if(venues.name != null) {
						content += '&nbsp;' + venues.name + '<br />';
					}
					if(venues.location.address != null) {
						content += '&nbsp;' + venues.location.address + '<br />';
					}
					if(venues.location.crossStreet != null) {
						content += ' &nbsp;' + venues.location.crossStreet + '<br />';
					}
					if(venues.location.city != null) {
						content += ' &nbsp;' + venues.location.city + ', ';
					}
					if(venues.location.state != null) {
						content += ' &nbsp;' + venues.location.state + '';
					}
					if(venues.location.postalCode != null) {
						content += ' &nbsp;' + venues.location.postalCode + '';
					}
					if(venues.location.distance != null) {
						content += '<br /> &nbsp; Distance: ' + venues.location.distance + '<br />';
					}
					if(venues.contact.phone != null) {
						content += '&nbsp;' + venues.location.phone + '<br />';
					}
					// content += '<br /><br />';
					content += '</p> </center>';
					$(content).appendTo("#names");
		       });
		});
	</script>
</body>
</html>